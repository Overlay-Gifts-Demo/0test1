<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JEWELS-AI | 10 Target Drive AR</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

  <style>
    body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
    #blackCurtain {
      position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
      background: #000; z-index: 99999; display: flex;
      flex-direction: column; justify-content: center; align-items: center;
      transition: opacity 0.5s ease; cursor: pointer;
    }
    #videoLoader {
      position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px;
      z-index: 500; display: none; font-weight: bold;
    }
    .button-panel { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: none; z-index: 100; }
    .plan-button { padding: 14px 28px; border-radius: 12px; background: #5E0F8B; color: #fff; border: none; font-weight: bold; cursor: pointer; }
    #instagramButton { position: fixed; bottom: 25px; right: 25px; width: 55px; height: 55px; z-index: 1000; background: white; border-radius: 14px; display: flex; align-items: center; justify-content: center; }
    #instagramButton img { width: 38px; height: 38px; }
    [class^="mindar-ui"] { display: none !important; }
  </style>
</head>

<body>

<div id="blackCurtain">
  <div style="font-size: 50px; margin-bottom: 20px;">üì∑</div>
  <div style="color: white; text-transform: uppercase; letter-spacing: 2px;">Tap to Start Camera</div>
</div>

<div id="videoLoader">Downloading Video...</div>

<a href="https://www.instagram.com/craftwithdivya/" target="_blank" id="instagramButton">
  <img src="https://upload.wikimedia.org/wikipedia/commons/a/a5/Instagram_icon.png" alt="Instagram">
</a>

<div class="button-panel" id="planButtons">
  <button class="plan-button" id="toggleButton">‚ñ∂Ô∏è Play Video</button>
</div>

<a-scene 
  mindar-image="imageTargetSrc: ./targets.mind; uiLoading: no; uiError: no; autoStart: false;"
  vr-mode-ui="enabled: false"
  device-orientation-permission-ui="enabled: false"
  renderer="antialias: true; alpha: true; colorManagement: true;">

  <a-assets>
    <video id="driveVideo" playsinline webkit-playsinline loop crossorigin="anonymous" muted></video>
  </a-assets>

  <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

  <a-entity id="target0" class="ar-target" mindar-image-target="targetIndex: 0">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target1" class="ar-target" mindar-image-target="targetIndex: 1">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target2" class="ar-target" mindar-image-target="targetIndex: 2">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target3" class="ar-target" mindar-image-target="targetIndex: 3">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target4" class="ar-target" mindar-image-target="targetIndex: 4">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target5" class="ar-target" mindar-image-target="targetIndex: 5">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target6" class="ar-target" mindar-image-target="targetIndex: 6">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target7" class="ar-target" mindar-image-target="targetIndex: 7">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target8" class="ar-target" mindar-image-target="targetIndex: 8">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

  <a-entity id="target9" class="ar-target" mindar-image-target="targetIndex: 9">
    <a-plane class="video-plane" width="1" height="1" visible="false" material="src: #driveVideo; transparent: true; shader: flat;"></a-plane>
  </a-entity>

</a-scene>

<script>
const API_KEY = "AIzaSyC_6UEJhSjWUnWaXlBpHy9MYiJAWiX5EBI"; 
const FOLDER_MAPPING = {
  0: "1VwMKpxjmNMy02Roe_qEDG8Dw3lsgIveV",
  1: "1TZMdimrOzo_0j2esYkj74ELdSIXBQSjl",
  2: "1gSqItbKhJpLvYBGQv1NI0fWXkJFJp31S",
  3: "1ADJEYEnNurtn3-BbxvJ8MhcNwvlCjY5h",
  4: "1YLkD0LnVbN0YmTxgsSYE8nu7eVe38U1p",
  5: "1rJb924UWifl0MOlukPSsBRWWVOE1ROEg",
  6: "1afD_fabfAD8xWMmlgkvu5s_n-PQRnLkB",
  7: "1N1m0JSjRT58I1VUMZ14YvQxq_pvCOuIR",
  8: "14cgEAsf_dnX7bDPGaH-UjxK_WkQJoDTO",
  9: "1K4aAHFqWWB4Et4uIHVY1OqJsBDMA2cip"
};

async function getLatestVideo(targetIndex) {
  const folderId = FOLDER_MAPPING[targetIndex];
  const url = `https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&orderBy=modifiedTime+desc&pageSize=1&key=${API_KEY}`;
  try {
    const res = await fetch(url);
    const data = await res.json();
    return (data.files && data.files.length > 0) ? data.files[0].id : null;
  } catch (e) { return null; }
}

window.addEventListener("load", () => {
  const videoEl = document.querySelector("#driveVideo");
  const toggleButton = document.querySelector("#toggleButton");
  const sceneEl = document.querySelector('a-scene');
  const loader = document.querySelector("#videoLoader");

  let activeIndex = null;

  document.querySelector("#blackCurtain").addEventListener("click", (e) => {
    sceneEl.systems['mindar-image-system'].start();
    videoEl.play().then(() => videoEl.pause());
    e.currentTarget.style.display = "none";
  });

  document.querySelectorAll('.ar-target').forEach((targetEl, index) => {
    targetEl.addEventListener("targetFound", async () => {
      activeIndex = index;
      document.querySelector("#planButtons").style.display = "block";
      loader.style.display = "block";
      
      const fileId = await getLatestVideo(index);
      if (fileId) {
        videoEl.src = `https://www.googleapis.com/drive/v3/files/${fileId}?alt=media&key=${API_KEY}`;
        videoEl.load();
        
        videoEl.oncanplay = () => {
          loader.style.display = "none";
          videoEl.play();
          toggleButton.textContent = "‚è∏ Pause Video";
        };
      }
    });

    targetEl.addEventListener("targetLost", () => {
      document.querySelector("#planButtons").style.display = "none";
      videoEl.pause();
      targetEl.querySelector('.video-plane').setAttribute('visible', 'false');
      activeIndex = null;
    });
  });

  videoEl.addEventListener('playing', () => {
    if (activeIndex !== null) {
      document.querySelector(`#target${activeIndex} .video-plane`).setAttribute('visible', 'true');
    }
  });

  toggleButton.addEventListener("click", () => {
    if (videoEl.paused) {
      videoEl.muted = false;
      videoEl.play();
      toggleButton.textContent = "‚è∏ Pause Video";
    } else {
      videoEl.pause();
      toggleButton.textContent = "‚ñ∂Ô∏è Play Video";
    }
  });
});
</script>
</body>
</html>